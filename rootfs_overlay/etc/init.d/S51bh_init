#!/bin/bash

start() {
    # If Armbian Build
    if grep -qi '^ID=debian' /etc/os-release; then
        mount --bind /boot/bh /mnt/
        USB_HUB=0424:2514
        # If Blackpants (USB Hub exists)
        if lsusb -d "$USB_HUB" >/dev/null 2>&1; then
            echo "Connect to Blackpants"
            echo 2 > /sys/class/graphics/fbcon/rotate
        # Else Flipper (No Hub)
        else
            echo "Connect to Flipper Zero"
        fi
        source /mnt/blackhat.conf
    # Else its the old Buildroot Build
    else
        # Turn on LED / Probe screen drivers
        echo 1 > /sys/devices/platform/leds/leds/blackhat:green:usr/brightness
        modprobe pwm_bl
        modprobe panel_sitronix_st7701
    fi

    echo "Welcome to BlackhatOS."
}

stop() {
    echo "Stopping"
}

case "$1" in
    start|stop)
        "$1";;
    *)
        echo "Usage: $0 {start|stop}"
        exit 1
esac
